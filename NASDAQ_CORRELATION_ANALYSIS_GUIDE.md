# NASDAQ 相關性分析功能使用說明

## 功能概述

在 http://localhost/ 的前端界面上，可以分析 NASDAQ 所屬各股與納斯達克綜合指數（^IXIC）的相關性，並將符合條件的個股列在股票相關性分析列表中。

## 使用步驟

### 1. 選擇 NASDAQ 指數

- 打開瀏覽器訪問 `http://localhost/`
- 在頁面頂部的三個指數標籤中，選擇 **"NASDAQ"**

### 2. 設定日期範圍

- 在 K 線圖區域右上角，有兩個日期選擇器：
  - **起始日期**：選擇分析開始日期（例如：2024-01-01）
  - **結束日期**：選擇分析結束日期（例如：2026-01-26）
- 設定好日期後，點擊 **"套用"** 按鈕

### 3. 設定相關性閾值

- 在日期選擇器旁邊，有一個 **"相關性閾值"** 輸入框
- 輸入你想要的閾值（範圍 0-1，例如：0.90）
- 只有相關係數**大於**此閾值的股票才會顯示在列表中

### 4. 開始分析

- 點擊綠色的 **"分析"** 按鈕
- 系統會開始計算所有本地存儲的股票與納斯達克指數的相關性
- 分析過程中按鈕會顯示 "分析中..."

### 5. 查看結果

- 分析完成後，頁面下方的 **"成分股相關性分析"** 區域會顯示結果表格
- 表格包含以下欄位：
  - **股票代碼**：點擊可查看該股票的走勢圖（疊加在指數圖上）
  - **股票名稱**：公司全稱
  - **相關係數**：與納斯達克指數的相關係數（-1 到 1）
  - **相關性評級**：
    - 🔴 高度相關：≥ 0.8（紅色標籤）
    - 🟡 中度相關：0.5-0.8（黃色標籤）
    - 🔵 低度相關：0.3-0.5（藍色標籤）
    - ⚫ 弱相關：< 0.3（灰色標籤）

### 6. 查看個股走勢（可選）

- 點擊表格中的任意股票代碼
- K 線圖上會疊加該股票的走勢線（藍色）
- 可以直觀比較股票與指數的走勢一致性
- 再次點擊相同股票代碼可取消選中

## 參數說明

### 日期範圍

- **建議範圍**：至少選擇 6 個月以上的數據，以獲得更準確的相關性分析
- **可用範圍**：2010-01-01 至今（取決於本地存儲的數據）
- **注意**：較短的時間範圍可能導致相關性結果不準確

### 相關性閾值

- **0.9-1.0**：尋找與納斯達克指數走勢幾乎完全一致的股票（最嚴格）
- **0.8-0.9**：尋找高度相關的股票（推薦用於追蹤納斯達克走勢）
- **0.5-0.8**：尋找中度相關的股票
- **0.3-0.5**：尋找低度相關的股票
- **< 0.3**：弱相關或負相關股票

### 推薦設定

- **追蹤納斯達克**：閾值設為 0.90，日期範圍 2024-01-01 至 2026-01-26
- **多元化投資**：閾值設為 0.50，查看中度相關的股票
- **風險對沖**：閾值設為 -0.50（需修改代碼支持負值篩選）

## 實際應用場景

### 1. 指數追蹤投資

**設定**：閾值 0.95，日期 2024-01-01 至 2026-01-26

**用途**：

- 找出最貼近納斯達克指數走勢的個股或 ETF
- QQQ (相關性 0.9984) 是最佳選擇
- NVDA、AVGO 等科技巨頭也有 0.96+ 的高相關性

### 2. 科技股篩選

**設定**：閾值 0.85，日期 2024-01-01 至 2026-01-26

**用途**：

- 篩選與納斯達克高度相關的科技股
- 這些股票通常能代表科技產業整體趨勢
- 適合看好科技股的投資者

### 3. 趨勢確認

**設定**：閾值 0.70，日期 最近 1 年

**用途**：

- 確認個股是否跟隨大盤趨勢
- 相關性突然下降可能表示個股出現問題
- 相關性上升表示個股重新回歸大盤節奏

## 技術細節

### 後端 API

- **端點**：`POST /storage/correlation-analysis`
- **請求參數**：
  ```json
  {
    "index_symbol": "^IXIC",
    "threshold": 0.9,
    "start_date": "2024-01-01",
    "end_date": "2026-01-26"
  }
  ```
- **響應格式**：
  ```json
  {
    "correlations": [
      {
        "symbol": "QQQ",
        "name": "Invesco QQQ Trust",
        "correlation": 0.9984,
        "data_points": 517
      }
    ],
    "total_analyzed": 1948,
    "high_correlation_count": 103,
    "threshold": 0.9,
    "date_range": {
      "start": "2024-01-02",
      "end": "2026-01-26",
      "trading_days": 518
    }
  }
  ```

### 數據來源

- **指數數據**：從本地存儲 `/app/data/stocks/^IXIC.json.gz` 讀取
- **股票數據**：從本地存儲 `/app/data/stocks/*.json.gz` 讀取
- **計算方法**：使用 Pearson 相關係數

### 性能優化

- **並行計算**：使用 20 個線程同時分析多支股票
- **數據過濾**：只分析有至少 30 個交易日共同數據的股票
- **結果篩選**：只返回相關係數大於閾值的股票

## 常見問題

### Q: 為什麼分析結果為空？

A: 可能原因：

1. 閾值設定過高（如 > 0.95）
2. 日期範圍設定錯誤或數據不足
3. 本地數據未更新

**解決方法**：降低閾值至 0.80-0.90

### Q: 分析需要多長時間？

A: 通常 10-30 秒，取決於：

- 本地存儲的股票數量
- 日期範圍長度
- 服務器性能

### Q: 可以分析其他指數嗎？

A: 可以！只需：

1. 切換到其他指數標籤（道瓊工業指數或 S&P 500）
2. 按相同步驟操作
3. 系統會自動使用對應的指數數據進行分析

### Q: 相關性分析的數據是實時的嗎？

A: 數據更新取決於本地存儲：

- 本地數據需要定期更新（通過下載腳本）
- 更新後重新分析即可獲得最新結果

## 2024-2026 年分析結果摘要

基於 2024-01-01 至 2026-01-26 的數據分析：

### 閾值 0.90 以上（103 支股票）

- **QQQ**: 0.9984（納斯達克 100 ETF，最佳追蹤標的）
- **NVDA**: 0.9654（輝達，AI 芯片龍頭）
- **AVGO**: 0.9654（博通，半導體巨頭）
- **CRDO**: 0.9568（Credo Technology）
- **APP**: 0.9371（AppLovin）

### 閾值 0.80-0.90（約 200 支股票）

- 包含大量科技股、金融股和 ETF
- 這些股票能較好地跟隨納斯達克趨勢

### 統計數據

- 總分析股票數：1,948 支
- 高度相關（≥0.80）：317 支（16.3%）
- 中度相關（0.50-0.80）：406 支（20.9%）
- 低度相關（0-0.50）：334 支（17.2%）
- 負相關（<0）：891 支（45.8%）

## 更新記錄

- **2026-01-27**：實現 NASDAQ 相關性分析功能
- 支持動態閾值設定
- 支持自定義日期範圍
- 使用本地存儲數據，分析速度快
- 並行計算優化，處理 1,900+ 支股票僅需 10-30 秒

---

**提示**：建議定期更新本地數據以獲得最新的相關性分析結果！
